<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M5StampPLC Batch Fill Controller - Wiring Schematic v0.08</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #151b24;
            --bg-card: #1a2332;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-power: #ff6b6b;
            --accent-ground: #4dabf7;
            --accent-signal: #51cf66;
            --accent-relay: #ffd43b;
            --accent-opto: #ff9500;
            --border-color: #30363d;
            --grid-color: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2.5rem;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                var(--accent-power) 0%, 
                var(--accent-relay) 25%, 
                var(--accent-signal) 50%, 
                var(--accent-ground) 75%, 
                var(--accent-opto) 100%);
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-signal) 0%, var(--accent-relay) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95rem;
            color: var(--accent-signal);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .version-badge {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.5rem 1.5rem;
            background: var(--bg-primary);
            border: 1px solid var(--accent-relay);
            border-radius: 20px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-relay);
        }

        .legend {
            display: flex;
            gap: 2.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
            padding: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .legend-line {
            width: 45px;
            height: 4px;
            border-radius: 2px;
            box-shadow: 0 0 10px currentColor;
        }

        .power-line { background: var(--accent-power); color: var(--accent-power); }
        .ground-line { background: var(--accent-ground); color: var(--accent-ground); }
        .signal-line { background: var(--accent-signal); color: var(--accent-signal); }
        .relay-line { background: var(--accent-relay); color: var(--accent-relay); }

        .schematic-wrapper {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .schematic-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(var(--grid-color) 1.5px, transparent 1.5px),
                linear-gradient(90deg, var(--grid-color) 1.5px, transparent 1.5px);
            background-size: 30px 30px;
            pointer-events: none;
            opacity: 0.4;
        }

        svg {
            width: 100%;
            height: auto;
            position: relative;
            z-index: 1;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .info-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            transition: transform 0.2s, border-color 0.2s;
        }

        .info-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-signal);
        }

        .info-card h3 {
            font-size: 1.2rem;
            margin-bottom: 1.2rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .info-card h3::before {
            content: '';
            width: 5px;
            height: 24px;
            background: linear-gradient(180deg, var(--accent-signal) 0%, var(--accent-relay) 100%);
            border-radius: 3px;
        }

        .info-card ul {
            list-style: none;
        }

        .info-card li {
            padding: 0.65rem 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .info-card li:last-child {
            border-bottom: none;
        }

        .info-card strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .warning-box {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.15) 0%, rgba(255, 107, 107, 0.05) 100%);
            border: 2px solid var(--accent-power);
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .warning-box h3 {
            color: var(--accent-power);
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .warning-box h3::before {
            content: '⚡';
            font-size: 1.5rem;
        }

        .warning-box ul {
            list-style: none;
            color: var(--text-secondary);
        }

        .warning-box li {
            padding: 0.6rem 0;
            padding-left: 2rem;
            position: relative;
            line-height: 1.6;
        }

        .warning-box li::before {
            content: '▸';
            position: absolute;
            left: 0.5rem;
            color: var(--accent-power);
            font-weight: bold;
        }

        .warning-box li strong {
            color: var(--text-primary);
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            border-top: 1px solid var(--border-color);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>M5StampPLC Batch Fill Controller</h1>
            <div class="subtitle">Professional Wiring Schematic</div>
            <div class="version-badge">Version 0.08 • 4-Channel Flowmeter Control System</div>
        </header>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-line power-line"></div>
                <span>Power (+12-24V)</span>
            </div>
            <div class="legend-item">
                <div class="legend-line ground-line"></div>
                <span>Ground (GND)</span>
            </div>
            <div class="legend-item">
                <div class="legend-line signal-line"></div>
                <span>Control Signal</span>
            </div>
            <div class="legend-item">
                <div class="legend-line relay-line"></div>
                <span>Relay Output</span>
            </div>
        </div>

        <div class="schematic-wrapper">
            <svg viewBox="0 0 1500 1150" xmlns="http://www.w3.org/2000/svg">
                <!-- SVG content stays the same as before but I'll optimize it -->
                <defs>
                    <filter id="glow">
                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                        <feMerge>
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                    <filter id="shadow">
                        <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                    </filter>
                </defs>

                <style>
                    .comp-label { font-family: 'IBM Plex Mono', monospace; font-size: 14px; font-weight: 600; fill: #e6edf3; }
                    .comp-title { font-family: 'Space Grotesk', sans-serif; font-size: 16px; font-weight: 700; fill: #e6edf3; }
                    .pin-label { font-family: 'IBM Plex Mono', monospace; font-size: 11px; fill: #8b949e; }
                    .voltage-label { font-family: 'IBM Plex Mono', monospace; font-size: 12px; font-weight: 700; fill: #ff6b6b; }
                </style>

                <!-- Power Supply -->
                <g id="power-supply" filter="url(#shadow)">
                    <rect x="30" y="40" width="180" height="160" fill="#1a2332" stroke="#ff6b6b" stroke-width="3" rx="10"/>
                    <text x="120" y="75" text-anchor="middle" class="comp-title" style="fill: #ff6b6b;">POWER SUPPLY</text>
                    <text x="120" y="95" text-anchor="middle" class="pin-label">12-24V DC • 2-3A</text>
                    
                    <circle cx="80" cy="130" r="12" fill="#ff6b6b" filter="url(#glow)"/>
                    <text x="110" y="137" class="voltage-label">+VDC</text>
                    
                    <circle cx="80" cy="170" r="12" fill="#4dabf7" filter="url(#glow)"/>
                    <text x="110" y="177" class="pin-label" style="fill: #4dabf7; font-weight: 600;">GND</text>
                </g>

                <!-- M5StampPLC -->
                <g id="stampplc" filter="url(#shadow)">
                    <rect x="280" y="40" width="400" height="240" fill="#1a2332" stroke="#51cf66" stroke-width="3" rx="10"/>
                    <text x="480" y="75" text-anchor="middle" class="comp-title" style="fill: #51cf66; font-size: 18px;">M5StampPLC</text>
                    <text x="480" y="95" text-anchor="middle" class="pin-label">Main Controller • ESP32-based</text>
                    
                    <!-- Power terminals -->
                    <circle cx="305" cy="130" r="6" fill="#ff6b6b"/>
                    <text x="318" y="135" class="pin-label">VIN</text>
                    <circle cx="305" cy="160" r="6" fill="#4dabf7"/>
                    <text x="318" y="165" class="pin-label">G</text>
                    <circle cx="305" cy="190" r="6" fill="#8b949e"/>
                    <text x="318" y="195" class="pin-label">COM</text>
                    
                    <!-- Input switches -->
                    <text x="305" y="230" class="pin-label">INPUTS:</text>
                    <circle cx="370" cy="225" r="5" fill="#51cf66"/>
                    <text x="380" y="230" class="pin-label">SW1</text>
                    <circle cx="430" cy="225" r="5" fill="#51cf66"/>
                    <text x="440" y="230" class="pin-label">SW2</text>
                    <circle cx="490" cy="225" r="5" fill="#51cf66"/>
                    <text x="500" y="230" class="pin-label">SW3</text>
                    <circle cx="550" cy="225" r="5" fill="#51cf66"/>
                    <text x="560" y="230" class="pin-label">SW4</text>
                    
                    <!-- Port indicators -->
                    <rect x="390" y="248" width="70" height="22" fill="#30363d" stroke="#ffd43b" stroke-width="1.5" rx="4"/>
                    <text x="425" y="264" text-anchor="middle" class="pin-label" style="fill: #ffd43b;">PORT A</text>
                    
                    <rect x="500" y="248" width="70" height="22" fill="#30363d" stroke="#ffd43b" stroke-width="1.5" rx="4"/>
                    <text x="535" y="264" text-anchor="middle" class="pin-label" style="fill: #ffd43b;">PORT B</text>
                    
                    <!-- Outputs -->
                    <circle cx="675" cy="130" r="6" fill="#ffd43b"/>
                    <text x="600" y="135" class="pin-label">OUT1</text>
                    <circle cx="675" cy="165" r="6" fill="#ffd43b"/>
                    <text x="600" y="170" class="pin-label">OUT2</text>
                    <circle cx="675" cy="200" r="6" fill="#ffd43b"/>
                    <text x="600" y="205" class="pin-label">OUT3</text>
                    <circle cx="675" cy="235" r="6" fill="#ffd43b"/>
                    <text x="600" y="240" class="pin-label">OUT4</text>
                </g>

                <!-- Power connections -->
                <path d="M 80 130 L 240 130 L 240 130 L 305 130" 
                      stroke="#ff6b6b" stroke-width="4" fill="none" stroke-linecap="round"/>
                <path d="M 80 170 L 240 170 L 240 160 L 305 160" 
                      stroke="#4dabf7" stroke-width="4" fill="none" stroke-linecap="round"/>

                <!-- Relay Module -->
                <g id="relays" filter="url(#shadow)">
                    <rect x="280" y="380" width="560" height="230" fill="#1a2332" stroke="#ffd43b" stroke-width="3" rx="10"/>
                    <text x="560" y="415" text-anchor="middle" class="comp-title" style="fill: #ffd43b;">4-CHANNEL RELAY MODULE</text>
                    <text x="560" y="435" text-anchor="middle" class="pin-label">12-24V Coil • NO/NC Contacts</text>
                    
                    <!-- Relay 1 -->
                    <g>
                        <rect x="310" y="460" width="105" height="130" fill="#2d1f1f" stroke="#ffd43b" stroke-width="2" rx="6"/>
                        <text x="362" y="485" text-anchor="middle" class="comp-label" style="fill: #ffd43b;">① RELAY</text>
                        <circle cx="330" cy="510" r="5" fill="#e6edf3"/>
                        <text x="342" y="515" class="pin-label">NO</text>
                        <circle cx="330" cy="540" r="5" fill="#e6edf3"/>
                        <text x="342" y="545" class="pin-label">C</text>
                        <circle cx="330" cy="570" r="5" fill="#e6edf3"/>
                        <text x="342" y="575" class="pin-label">NC</text>
                        <circle cx="395" cy="470" r="5" fill="#51cf66"/>
                        <text x="370" y="475" class="pin-label">IN</text>
                    </g>
                    
                    <!-- Relay 2 -->
                    <g>
                        <rect x="435" y="460" width="105" height="130" fill="#2d1f1f" stroke="#ffd43b" stroke-width="2" rx="6"/>
                        <text x="487" y="485" text-anchor="middle" class="comp-label" style="fill: #ffd43b;">② RELAY</text>
                        <circle cx="455" cy="510" r="5" fill="#e6edf3"/>
                        <text x="467" y="515" class="pin-label">NO</text>
                        <circle cx="455" cy="540" r="5" fill="#e6edf3"/>
                        <text x="467" y="545" class="pin-label">C</text>
                        <circle cx="455" cy="570" r="5" fill="#e6edf3"/>
                        <text x="467" y="575" class="pin-label">NC</text>
                        <circle cx="520" cy="470" r="5" fill="#51cf66"/>
                        <text x="495" y="475" class="pin-label">IN</text>
                    </g>
                    
                    <!-- Relay 3 -->
                    <g>
                        <rect x="560" y="460" width="105" height="130" fill="#2d1f1f" stroke="#ffd43b" stroke-width="2" rx="6"/>
                        <text x="612" y="485" text-anchor="middle" class="comp-label" style="fill: #ffd43b;">③ RELAY</text>
                        <circle cx="580" cy="510" r="5" fill="#e6edf3"/>
                        <text x="592" y="515" class="pin-label">NO</text>
                        <circle cx="580" cy="540" r="5" fill="#e6edf3"/>
                        <text x="592" y="545" class="pin-label">C</text>
                        <circle cx="580" cy="570" r="5" fill="#e6edf3"/>
                        <text x="592" y="575" class="pin-label">NC</text>
                        <circle cx="645" cy="470" r="5" fill="#51cf66"/>
                        <text x="620" y="475" class="pin-label">IN</text>
                    </g>
                    
                    <!-- Relay 4 -->
                    <g>
                        <rect x="685" y="460" width="105" height="130" fill="#2d1f1f" stroke="#ffd43b" stroke-width="2" rx="6"/>
                        <text x="737" y="485" text-anchor="middle" class="comp-label" style="fill: #ffd43b;">④ RELAY</text>
                        <circle cx="705" cy="510" r="5" fill="#e6edf3"/>
                        <text x="717" y="515" class="pin-label">NO</text>
                        <circle cx="705" cy="540" r="5" fill="#e6edf3"/>
                        <text x="717" y="545" class="pin-label">C</text>
                        <circle cx="705" cy="570" r="5" fill="#e6edf3"/>
                        <text x="717" y="575" class="pin-label">NC</text>
                        <circle cx="770" cy="470" r="5" fill="#51cf66"/>
                        <text x="745" y="475" class="pin-label">IN</text>
                    </g>
                </g>

                <!-- StampPLC to Relay connections -->
                <path d="M 675 130 L 760 130 L 760 420 L 395 420 L 395 470" 
                      stroke="#51cf66" stroke-width="3" fill="none" stroke-linecap="round"/>
                <path d="M 675 165 L 770 165 L 770 410 L 520 410 L 520 470" 
                      stroke="#51cf66" stroke-width="3" fill="none" stroke-linecap="round"/>
                <path d="M 675 200 L 780 200 L 780 400 L 645 400 L 645 470" 
                      stroke="#51cf66" stroke-width="3" fill="none" stroke-linecap="round"/>
                <path d="M 675 235 L 790 235 L 790 390 L 770 390 L 770 470" 
                      stroke="#51cf66" stroke-width="3" fill="none" stroke-linecap="round"/>

                <!-- Power to relay commons -->
                <path d="M 80 130 L 80 540 L 330 540" 
                      stroke="#ff6b6b" stroke-width="4" fill="none"/>
                <path d="M 80 540 L 455 540" 
                      stroke="#ff6b6b" stroke-width="4" fill="none"/>
                <path d="M 80 540 L 580 540" 
                      stroke="#ff6b6b" stroke-width="4" fill="none"/>
                <path d="M 80 540 L 705 540" 
                      stroke="#ff6b6b" stroke-width="4" fill="none"/>

                <!-- Valves -->
                <g id="valves">
                    <text x="560" y="665" text-anchor="middle" class="comp-title">SOLENOID VALVES</text>
                    <text x="560" y="685" text-anchor="middle" class="pin-label">12-20V DC • Normally Closed</text>
                    
                    <!-- Valve 1 -->
                    <g filter="url(#shadow)">
                        <rect x="310" y="710" width="90" height="100" fill="#1f2d1f" stroke="#51cf66" stroke-width="2" rx="6"/>
                        <text x="355" y="735" text-anchor="middle" class="comp-label" style="fill: #51cf66;">V1</text>
                        <circle cx="335" cy="765" r="5" fill="#ff6b6b"/>
                        <text x="347" y="770" class="pin-label">+</text>
                        <circle cx="335" cy="790" r="5" fill="#4dabf7"/>
                        <text x="347" y="795" class="pin-label">-</text>
                    </g>
                    
                    <!-- Valve 2 -->
                    <g filter="url(#shadow)">
                        <rect x="435" y="710" width="90" height="100" fill="#1f2d1f" stroke="#51cf66" stroke-width="2" rx="6"/>
                        <text x="480" y="735" text-anchor="middle" class="comp-label" style="fill: #51cf66;">V2</text>
                        <circle cx="460" cy="765" r="5" fill="#ff6b6b"/>
                        <text x="472" y="770" class="pin-label">+</text>
                        <circle cx="460" cy="790" r="5" fill="#4dabf7"/>
                        <text x="472" y="795" class="pin-label">-</text>
                    </g>
                    
                    <!-- Valve 3 -->
                    <g filter="url(#shadow)">
                        <rect x="560" y="710" width="90" height="100" fill="#1f2d1f" stroke="#51cf66" stroke-width="2" rx="6"/>
                        <text x="605" y="735" text-anchor="middle" class="comp-label" style="fill: #51cf66;">V3</text>
                        <circle cx="585" cy="765" r="5" fill="#ff6b6b"/>
                        <text x="597" y="770" class="pin-label">+</text>
                        <circle cx="585" cy="790" r="5" fill="#4dabf7"/>
                        <text x="597" y="795" class="pin-label">-</text>
                    </g>
                    
                    <!-- Valve 4 -->
                    <g filter="url(#shadow)">
                        <rect x="685" y="710" width="90" height="100" fill="#1f2d1f" stroke="#51cf66" stroke-width="2" rx="6"/>
                        <text x="730" y="735" text-anchor="middle" class="comp-label" style="fill: #51cf66;">V4</text>
                        <circle cx="710" cy="765" r="5" fill="#ff6b6b"/>
                        <text x="722" y="770" class="pin-label">+</text>
                        <circle cx="710" cy="790" r="5" fill="#4dabf7"/>
                        <text x="722" y="795" class="pin-label">-</text>
                    </g>
                </g>

                <!-- Relay NO to Valve + -->
                <path d="M 330 510 L 330 650 L 320 650 L 320 765 L 335 765" 
                      stroke="#ffd43b" stroke-width="4" fill="none" stroke-linecap="round"/>
                <path d="M 455 510 L 455 655 L 445 655 L 445 765 L 460 765" 
                      stroke="#ffd43b" stroke-width="4" fill="none" stroke-linecap="round"/>
                <path d="M 580 510 L 580 660 L 570 660 L 570 765 L 585 765" 
                      stroke="#ffd43b" stroke-width="4" fill="none" stroke-linecap="round"/>
                <path d="M 705 510 L 705 665 L 695 665 L 695 765 L 710 765" 
                      stroke="#ffd43b" stroke-width="4" fill="none" stroke-linecap="round"/>

                <!-- Ground to valves -->
                <path d="M 80 170 L 80 880 L 335 880 L 335 790" 
                      stroke="#4dabf7" stroke-width="4" fill="none"/>
                <path d="M 80 880 L 460 880 L 460 790" 
                      stroke="#4dabf7" stroke-width="4" fill="none"/>
                <path d="M 80 880 L 585 880 L 585 790" 
                      stroke="#4dabf7" stroke-width="4" fill="none"/>
                <path d="M 80 880 L 710 880 L 710 790" 
                      stroke="#4dabf7" stroke-width="4" fill="none"/>

                <!-- OPTO Board -->
                <g id="opto" filter="url(#shadow)">
                    <rect x="980" y="380" width="320" height="460" fill="#1a2332" stroke="#ff9500" stroke-width="3" rx="10"/>
                    <text x="1140" y="415" text-anchor="middle" class="comp-title" style="fill: #ff9500;">OPTO BOARD</text>
                    <text x="1140" y="435" text-anchor="middle" class="pin-label">Optocoupler Isolation</text>
                    
                    <!-- Power section -->
                    <text x="1010" y="475" class="pin-label" style="font-weight: 600;">POWER:</text>
                    <circle cx="1020" cy="500" r="5" fill="#ff6b6b"/>
                    <text x="1032" y="505" class="voltage-label">+3.2V</text>
                    <circle cx="1020" cy="530" r="5" fill="#ff6b6b"/>
                    <text x="1032" y="535" class="voltage-label">+12-21V</text>
                    <circle cx="1020" cy="560" r="5" fill="#4dabf7"/>
                    <text x="1032" y="565" class="pin-label" style="fill: #4dabf7; font-weight: 600;">GND</text>
                    
                    <!-- Input section -->
                    <text x="1010" y="610" class="pin-label" style="font-weight: 600;">INPUTS:</text>
                    <circle cx="1020" cy="635" r="5" fill="#51cf66"/>
                    <text x="1032" y="640" class="pin-label">IN1</text>
                    <circle cx="1020" cy="665" r="5" fill="#51cf66"/>
                    <text x="1032" y="670" class="pin-label">IN2</text>
                    <circle cx="1020" cy="695" r="5" fill="#51cf66"/>
                    <text x="1032" y="700" class="pin-label">IN3</text>
                    <circle cx="1020" cy="725" r="5" fill="#51cf66"/>
                    <text x="1032" y="730" class="pin-label">IN4</text>
                    <circle cx="1020" cy="755" r="5" fill="#4dabf7"/>
                    <text x="1032" y="760" class="pin-label" style="fill: #4dabf7;">GND</text>
                    
                    <!-- Output section -->
                    <text x="1190" y="610" class="pin-label" style="font-weight: 600;">OUTPUTS:</text>
                    <circle cx="1280" cy="635" r="5" fill="#ff9500"/>
                    <text x="1180" y="640" class="pin-label">OUT1 (GPIO1)</text>
                    <circle cx="1280" cy="665" r="5" fill="#ff9500"/>
                    <text x="1180" y="670" class="pin-label">OUT2 (GPIO2)</text>
                    <circle cx="1280" cy="695" r="5" fill="#ff9500"/>
                    <text x="1180" y="700" class="pin-label">OUT3 (GPIO4)</text>
                    <circle cx="1280" cy="725" r="5" fill="#ff9500"/>
                    <text x="1180" y="730" class="pin-label">OUT4 (GPIO5)</text>
                    
                    <text x="1140" y="795" text-anchor="middle" class="pin-label" style="fill: #ff9500;">Pin Map: 1,4,5,3</text>
                    <text x="1140" y="815" text-anchor="middle" class="pin-label">270Ω resistor may be required</text>
                </g>

                <!-- Flowmeters -->
                <g id="flowmeters">
                    <text x="1395" y="415" text-anchor="middle" class="comp-title">FLOWMETERS</text>
                    <text x="1395" y="435" text-anchor="middle" class="pin-label">Hall Effect / Reed Switch</text>
                    
                    <!-- FM1 -->
                    <g>
                        <circle cx="1395" cy="515" r="28" fill="none" stroke="#51cf66" stroke-width="3"/>
                        <path d="M 1375 515 L 1415 515 M 1395 495 L 1395 535" stroke="#51cf66" stroke-width="3"/>
                        <text x="1450" y="520" class="comp-label" style="fill: #51cf66;">① FM1</text>
                    </g>
                    
                    <!-- FM2 -->
                    <g>
                        <circle cx="1395" cy="610" r="28" fill="none" stroke="#51cf66" stroke-width="3"/>
                        <path d="M 1375 610 L 1415 610 M 1395 590 L 1395 630" stroke="#51cf66" stroke-width="3"/>
                        <text x="1450" y="615" class="comp-label" style="fill: #51cf66;">② FM2</text>
                    </g>
                    
                    <!-- FM3 -->
                    <g>
                        <circle cx="1395" cy="705" r="28" fill="none" stroke="#51cf66" stroke-width="3"/>
                        <path d="M 1375 705 L 1415 705 M 1395 685 L 1395 725" stroke="#51cf66" stroke-width="3"/>
                        <text x="1450" y="710" class="comp-label" style="fill: #51cf66;">③ FM3</text>
                    </g>
                    
                    <!-- FM4 -->
                    <g>
                        <circle cx="1395" cy="800" r="28" fill="none" stroke="#51cf66" stroke-width="3"/>
                        <path d="M 1375 800 L 1415 800 M 1395 780 L 1395 820" stroke="#51cf66" stroke-width="3"/>
                        <text x="1450" y="805" class="comp-label" style="fill: #51cf66;">④ FM4</text>
                    </g>
                </g>

                <!-- Flowmeter to OPTO connections -->
                <path d="M 1367 515 L 1330 515 L 1330 635 L 1020 635" 
                      stroke="#51cf66" stroke-width="3" fill="none"/>
                <path d="M 1367 610 L 1325 610 L 1325 665 L 1020 665" 
                      stroke="#51cf66" stroke-width="3" fill="none"/>
                <path d="M 1367 705 L 1320 705 L 1320 695 L 1020 695" 
                      stroke="#51cf66" stroke-width="3" fill="none"/>
                <path d="M 1367 800 L 1315 800 L 1315 725 L 1020 725" 
                      stroke="#51cf66" stroke-width="3" fill="none"/>

                <!-- OPTO to StampPLC GPIO (dashed) -->
                <path d="M 1280 635 L 1330 635 L 1330 100 L 540 100 L 540 115" 
                      stroke="#ff9500" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 1280 665 L 1325 665 L 1325 90 L 560 90 L 560 115" 
                      stroke="#ff9500" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 1280 695 L 1320 695 L 1320 80 L 580 80 L 580 115" 
                      stroke="#ff9500" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 1280 725 L 1315 725 L 1315 70 L 600 70 L 600 115" 
                      stroke="#ff9500" stroke-width="3" fill="none" stroke-dasharray="8,6"/>

                <!-- OPTO Power connections (dashed) -->
                <path d="M 80 130 L 80 20 L 950 20 L 950 500 L 1020 500" 
                      stroke="#ff6b6b" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 950 20 L 950 530 L 1020 530" 
                      stroke="#ff6b6b" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 80 170 L 80 950 L 970 950 L 970 560 L 1020 560" 
                      stroke="#4dabf7" stroke-width="3" fill="none" stroke-dasharray="8,6"/>
                <path d="M 970 950 L 970 755 L 1020 755" 
                      stroke="#4dabf7" stroke-width="3" fill="none" stroke-dasharray="8,6"/>

                <!-- Notes -->
                <text x="120" y="1020" class="pin-label" style="fill: #8b949e;">Note: PWR section provides +3.2V for OPTO low-voltage side</text>
                <text x="120" y="1045" class="pin-label" style="fill: #8b949e;">Dashed lines indicate isolated/optocoupled connections</text>
                <text x="120" y="1080" class="comp-label" style="fill: #51cf66;">✓ All connections verified per handwritten schematic 1/17/26</text>
                <text x="120" y="1105" class="pin-label">Revision: K • Version: 0.08 • Date: January 19, 2026</text>
            </svg>
        </div>

        <div class="info-grid">
            <div class="info-card">
                <h3>Components</h3>
                <ul>
                    <li><strong>M5StampPLC:</strong> ESP32-based controller with integrated display, 3 buttons</li>
                    <li><strong>4-Channel Relay Module:</strong> 12-24V coil, 10A contacts, NO/NC terminals</li>
                    <li><strong>Solenoid Valves (V1-V4):</strong> 12-20V DC, normally closed, 1/4" NPT</li>
                    <li><strong>OPTO Board:</strong> 4-channel optocoupler isolation for pulse inputs</li>
                    <li><strong>Flowmeters (FM1-FM4):</strong> Hall effect or reed switch, pulse output</li>
                    <li><strong>Power Supply:</strong> 12-24V DC regulated, 2-3A minimum capacity</li>
                </ul>
            </div>

            <div class="info-card">
                <h3>Connections</h3>
                <ul>
                    <li><strong>Power:</strong> 12-24V DC to StampPLC VIN, Relay Commons, OPTO high side, Valve negatives</li>
                    <li><strong>Ground:</strong> Common ground bus for all components</li>
                    <li><strong>Control:</strong> StampPLC OUT1-4 control Relay IN1-4 (active HIGH logic)</li>
                    <li><strong>Valves:</strong> Relay NO contacts switch valve positive terminals</li>
                    <li><strong>Flowmeters:</strong> Pulse outputs connect to OPTO IN1-4 for isolation</li>
                    <li><strong>Counters:</strong> OPTO OUT1-4 connect to GPIO1,2,4,5 (falling edge interrupts)</li>
                </ul>
            </div>

            <div class="info-card">
                <h3>GPIO Assignments</h3>
                <ul>
                    <li><strong>GPIO1:</strong> Flowmeter 1 pulse counter (INT, falling edge)</li>
                    <li><strong>GPIO2:</strong> Flowmeter 2 pulse counter (INT, falling edge)</li>
                    <li><strong>GPIO4:</strong> Flowmeter 3 pulse counter (INT, falling edge)</li>
                    <li><strong>GPIO5:</strong> Flowmeter 4 pulse counter (INT, falling edge)</li>
                    <li><strong>OUT1-4:</strong> Relay control outputs via PORT A & B</li>
                    <li><strong>SW1-4:</strong> Optional manual input switches (pull-up enabled)</li>
                </ul>
            </div>

            <div class="info-card">
                <h3>Wire Specifications</h3>
                <ul>
                    <li><strong>Power Mains:</strong> 16-18 AWG stranded, red for +, black for GND</li>
                    <li><strong>Valve Power:</strong> 18 AWG stranded, adequate for valve current (1-2A)</li>
                    <li><strong>Control Signals:</strong> 20-22 AWG stranded, color-coded recommended</li>
                    <li><strong>Flowmeter Cables:</strong> 3-conductor shielded cable, shield to ground</li>
                    <li><strong>Maximum Lengths:</strong> Power: unlimited, Signals: <10m, Flowmeters: <10m</li>
                    <li><strong>Terminations:</strong> Use ferrules or crimp terminals on all screw connections</li>
                </ul>
            </div>
        </div>

        <div class="warning-box">
            <h3>Safety & Installation Notes</h3>
            <ul>
                <li><strong>Power Disconnect:</strong> Always disconnect ALL power sources before wiring or servicing</li>
                <li><strong>Polarity Verification:</strong> Double-check +/- polarity on DC connections (reverse may destroy components)</li>
                <li><strong>Fuse Protection:</strong> Install 2-3A fuse or circuit breaker on main power supply line</li>
                <li><strong>OPTO Power Requirements:</strong> This board needs both +3.2V and +12-21V supplies. Confirm your specific board datasheet.</li>
                <li><strong>GPIO Pull-ups:</strong> Internal pull-up resistors are enabled in software (INPUT_PULLUP mode)</li>
                <li><strong>Valve Inrush Current:</strong> Solenoid valves draw high inrush current (2-3× steady-state). Ensure relay contacts rated for this.</li>
                <li><strong>Flyback Diodes:</strong> Add 1N4007 diodes across relay coils and valve coils for EMI suppression</li>
                <li><strong>Grounding Strategy:</strong> Use star grounding with single-point ground at power supply to minimize ground loops</li>
                <li><strong>Cable Routing:</strong> Route power cables separate from signal cables to reduce EMI/noise coupling</li>
                <li><strong>Testing Procedure:</strong> Test each channel individually before full system operation. Verify K-factor calibration.</li>
                <li><strong>Emergency Stop:</strong> Implement hardware E-stop button that cuts power to all valves</li>
                <li><strong>Water Protection:</strong> Keep all electronics in weatherproof enclosures if used in wet environments</li>
            </ul>
        </div>

        <footer>
            <p>M5StampPLC Batch Fill Controller • Version 0.08</p>
            <p>Schematic Date: January 19, 2026 • Revision K • Based on handwritten diagram 1/17/26</p>
            <p>For technical support and firmware, see accompanying documentation</p>
        </footer>
    </div>
</body>
</html>
